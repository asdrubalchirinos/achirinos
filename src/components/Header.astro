---
const { lang = "en" } = Astro.props as { lang?: "en" | "es" };

const translations = {
  en: {
    home: "Home",
    philosophy: "Philosophy",
    resume: "Resume",
    projects: "Projects",
    blog: "Blog",
    menu: "Menu",
  },
  es: {
    home: "Inicio",
    philosophy: "Filosofía",
    resume: "Currículum",
    projects: "Proyectos",
    blog: "Blog",
    menu: "Menú",
  },
};

const t = translations[lang];

const homeHref = lang === "en" ? "/en" : "/";

const links = [
  { href: homeHref, label: t.home },
  { href: `/${lang === "en" ? "en" : "es"}/philosophy`, label: t.philosophy },
  { href: `/${lang === "en" ? "en" : "es"}/resume`, label: t.resume },
  { href: `/${lang === "en" ? "en" : "es"}/projects`, label: t.projects },
  { href: "https://www.codigoergosum.com", label: `${t.blog} ↗` },
];

const otherLang = lang === "en" ? "es" : "en";
const otherLangLabel = lang === "en" ? "ES" : "EN";
const currentPath = Astro.url.pathname;

let otherLangPath;
if (lang === "en") {
  // English -> Spanish
  if (currentPath === "/en" || currentPath === "/en/") {
    otherLangPath = "/";
  } else {
    otherLangPath = currentPath.replace(/^\/en/, "/es");
  }
} else {
  // Spanish -> English
  if (currentPath === "/" || currentPath === "/es" || currentPath === "/es/") {
    otherLangPath = "/en";
  } else {
    otherLangPath = currentPath.replace(/^\/es/, "/en");
  }
}
---

<header class="relative flex justify-between items-center py-4">
  <!-- Desktop Navigation -->
  <nav class="hidden md:block">
    <ul class="flex space-x-4 items-center">
      {
        links.map((link) => (
          <li>
            <a
              href={link.href}
              class="text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100 transition-colors"
            >
              {link.label}
            </a>
          </li>
        ))
      }
      <li>
        <a
          href={otherLangPath}
          class="font-bold text-gray-700 dark:text-gray-300 hover:text-black dark:hover:text-white transition-colors ml-4 border border-gray-200 dark:border-gray-700 rounded px-2 py-1 text-xs"
        >
          {otherLangLabel}
        </a>
      </li>
    </ul>
  </nav>

  <!-- Mobile Hamburger Button -->
  <button
    id="mobile-menu-button"
    class="md:hidden text-gray-700 dark:text-gray-300 hover:text-black dark:hover:text-white focus:outline-none focus:ring-2 focus:ring-gray-400 rounded p-2"
    aria-expanded="false"
    aria-label={t.menu}
  >
    <svg
      class="w-6 h-6"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M4 6h16M4 12h16M4 18h16"></path>
    </svg>
  </button>

  <!-- Mobile Menu Panel -->
  <nav
    id="mobile-menu"
    class="hidden md:hidden absolute top-full left-0 right-0 bg-gray-50 dark:bg-black border-b border-gray-200 dark:border-gray-800 shadow-lg z-50"
  >
    <ul class="flex flex-col py-4 px-4 space-y-3">
      {
        links.map((link) => (
          <li>
            <a
              href={link.href}
              class="block text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-gray-100 transition-colors py-2"
            >
              {link.label}
            </a>
          </li>
        ))
      }
      <li class="pt-2 border-t border-gray-200 dark:border-gray-800">
        <a
          href={otherLangPath}
          class="inline-block font-bold text-gray-700 dark:text-gray-300 hover:text-black dark:hover:text-white transition-colors border border-gray-200 dark:border-gray-700 rounded px-3 py-2 text-sm"
        >
          {otherLangLabel}
        </a>
      </li>
    </ul>
  </nav>
</header>

<script>
  // Mobile menu toggle functionality
  const mobileMenuButton = document.getElementById("mobile-menu-button");
  const mobileMenu = document.getElementById("mobile-menu");

  if (mobileMenuButton && mobileMenu) {
    mobileMenuButton.addEventListener("click", () => {
      const isExpanded =
        mobileMenuButton.getAttribute("aria-expanded") === "true";

      // Toggle menu visibility
      mobileMenu.classList.toggle("hidden");

      // Update ARIA attribute
      mobileMenuButton.setAttribute("aria-expanded", String(!isExpanded));
    });

    // Close menu when clicking outside
    document.addEventListener("click", (event) => {
      const target = event.target as HTMLElement;
      if (!mobileMenuButton.contains(target) && !mobileMenu.contains(target)) {
        mobileMenu.classList.add("hidden");
        mobileMenuButton.setAttribute("aria-expanded", "false");
      }
    });

    // Close menu when clicking a link
    const mobileMenuLinks = mobileMenu.querySelectorAll("a");
    mobileMenuLinks.forEach((link) => {
      link.addEventListener("click", () => {
        mobileMenu.classList.add("hidden");
        mobileMenuButton.setAttribute("aria-expanded", "false");
      });
    });
  }
</script>

<style>
  /* Smooth transition for mobile menu */
  #mobile-menu {
    transition: all 0.3s ease-in-out;
  }
</style>
